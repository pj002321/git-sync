## Virtual Memory

컴퓨터 시스템에서 실제 물리적 메모리(RAM)의 크기에 관계없이, 프로그램이 사용할 수 있는 메모리 공간을 확장하는 기술이다.

OS 가 HDD의 일부 공간을 가상 메모리로 활용하여, 물리 메모리가 부족할 때에도 프로그램이 계속 실행될 수 있도록 돕는다.

### 개념

가상 메모리는 컴퓨터가 물리적 메모리보다 더 많은 메모리를 사용할 수 있도록 가상 주소 공간을 제공하는 메모리 관리 기법이다. 프로그램이 실행될 때 필요한 메모리보다 큰 메모리를 할당할 수 있게 하며, 물리적 메모리의 제한을 극복한다.

- 가상 주소 공간 : 프로세스마다 독립적인 메모리 주소 공간을 제공한다. 이로 인해 여러 프로세스가 동시에 실행되어도 서로 간의 메모리 충돌을 방지 할 수 있다.
- 메모리 보호 : 가상 메모리를 통해 한 프로세스가 다른 프로세스의 메모리에 접근하지 못하게 보호할 수 있다.

### 동작 원리

가상 메모리의 동작 원리는 크게 페이징과 세그멘테이션 두 가지 방식으로 이루어지며 페이징이 더 일반적으로 사용된다.

> **페이징** 가상 메모리와 물리적 메모리를 "페이지” 라는 작은 고정 크기의 블록으로 나누는 방식이다. 운영체제는 프로그램이 필요로 하는 메모리를 페이지 단위로 관리하며, 필요한 페이지만 물리 메모리에 적제한다. 

> 세그멘테이션 페이징과 달리 가상 메모리를 논리적으로 크기가 다른 “세그먼트”로 나누는 방식이다. 프로그램은 코드, 데이터, 스택 등의 메모리 공간을 각각 다른 세그먼트로 구분하여 관리한다. 

<aside> 💡

Q&A : 가상 메모리가 무엇인지와 동작 원리를 설명해주세요.

</aside>

### 왜 필요한가?

🔳 물리적 메모리의 한계 극복

모든 프로그램은 물리적 메모리에서만 실행된다면 한계에 부딪힐 수 있다. 가상 메모리는 물리 메모리가 부족해도 프로그램이 계속 실행될 수 있도록 도와주며, 물리 메모리 보다 더 큰 가상 주소 공간을 제공함으로써 대용량 프로그램이나 데이터도 실행할 수 있다.

🔳 프로세스 격리 및 메모리 보호

각 프로그램은 자신의 메모리 공간만 접근할 수 있어야한다. 가상 메모리는 각 프로세스에 독립적인 가상 주소 공간을 제공하며, 다른 프로그램이 프로세스의 메모리에 잘못 접근하는 것을 방지하고 시스템의 안정성을 높인다.

🔳 효율적인 메모리 사용

여러 프로세스를 동시에 실행할 수 있도록 도와주며, 운영체제는 가상 메모리를 사용하여 프로세스 간의 메모리 충돌을 방지하고, 물리적 메모리를 프로세스들이 적절히 나눠 사용할 수 있도록한다.

<aside> 💡

Q&A : 가상 메모리를 쓰는 이유는 무엇인가요?

</aside>

### 가상 메모리의 장점

🔳 확장된 메모리 공간 : 물리적 메모리 크기에 구애를 받지않기 때문에, 대규모 프로그램 실행, 데이터처리에 유용.

🔳 프로그램 실행 중단 방지 : 물리적 메모리가 부족한 상황이 발생해도, 가상 메모리를 통해 필요한 데이터를 디스크에서 가져와 계속 실행할 수 있어, 시스템 성능 저하를 최소화.

🔳 메모리 보호 및 프로세스 격리

🔳 메모리 효율성 향상

🔳 페이지 교체 알고리즘을 통한 성능 최적화 : 페이지 교체 알고리즘을 통해, 사용 빈도가 낮은 페이지를 교체하여, 자주 사용하는 페이지를 메모리에 유지 시켜 성능 저하를 최소화

🔳 간단한 프로그래밍 환경 제공 : 프로그래머는 복잡한 메모리 관리 작업을 줄일 수 있다.

### 가상 메모리의 단점

### 1. 속도 저하

🔳 페이지 폴트 : 필요한 데이터가 RAM에 없으면 디스크에서 불러오는데, 이 과정이 매우 느리다.

🔳 스왑 속도 문제 : 메모리가 부족하면 디스크에 있는 가상 메모리를 읽고 쓰는 과정이 많아져서 성능이 심각하게 떨어진다.

🔳 SSD 수명 단축 : SSD 는 쓰기 횟수가 많아지면 수명이 줄어드는데, 가상 메모리를 많이 사용하면 SSD의 마모가 빨라질 수 있다.

✅ **해결 방법**: RAM을 충분히 확보하거나, 가상 메모리 대신 캐시 활용!

### 2. 높은 CPU 오버 헤드

물리 주소가 아닌 논리 주소를 사용하기에, CPU는 MMU를 통해 논리→물리 주소로 변환을 한다. 이 과정에서 CPU 성능이 일부 사용될 수 있음.

✅ **해결 방법**: TLB(Translation Lookaside Buffer) 같은 캐시를 활용해 주소 변환 속도를 높임.

### 3. 메모리 단편화

시간이 지나면서 작은 메모리 블록이 여기저기 흩어지는 **단편화(Fragmentation)** 문제가 발생 🔳 **외부 단편화 (External Fragmentation)** 가상 메모리가 여러 개의 작은 조각으로 나뉘어, **새로운 큰 메모리를 할당하기 어려운 상황**

****🔳 **내부 단편화 (Internal Fragmentation)** 페이지 크기(보통 4KB)보다 작은 데이터를 저장할 때, **남는 공간이 낭비.**

✅ **해결 방법**: 페이지 크기를 조정하거나 **압축(Compaction) 기법**을 사용해 단편화를 줄임.

### 4. 보안 및 프라이버시 문제

디스크에 데이터를 저장하기 때문에, 악성 코드나 해킹 공격으로 부터 더 취약할 수 있음.

✅ **해결 방법**: **스왑 파일 암호화** (Windows BitLocker, Linux `dm-crypt` 등), 사용하지 않는 가상 메모리는 정리

### 5. 시스템 응답 시간 지연

데이터가 디스크에 저장되어 접근 속도가 느리고 시스템 응답 시간이 길어짐.

✅ **해결 방법**: 자주 사용하는 데이터는 **RAM에 유지**하도록 최적화.

<aside> 💡

Q&A : 가상 메모리의 장.단점

</aside>

### 가상 메모리의 최적화

- RAM이 충분하면 가상 메모리를 최소화
- SSD 대신 HDD에 스왑 파일 저장 (SSD 수명 보호)
- 자주 사용하는 데이터는 RAM에 캐싱하여 가상 메모리 사용 최소화
- 보안이 중요한 시스템은 스왑 파일 암호화

<aside> 💡

Q&A : 가상 메모리의 최적화 전략

</aside>

즉, 가상 메모리는 물리적 메모리 한계를 극복하고, 효율적인 메모리 관리를 가능하게 하는 기술이다. 프로그램은 실제 메모리 크기에 구애받지 않고 더 많은 메모리 공간을 사용할 수 있으며, 운영체제는 페이징을 통해 필요한 부분만 물리 메모리에 로드하여 메모리를 효율적으로 관리한다.

RAM이 부족할 때는 매우 유용하지만, 잘못 사용하면 성능 저하, 단편화, 보안 문제 등이 발생할 수 있게 때문에 적절히 사용해야 한다.

[[OS]]